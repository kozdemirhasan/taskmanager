<!DOCTYPE html>
<html lang="tr" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Görevlerim - Görev Takip Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .task-card {
            margin-bottom: 20px;
            border-radius: 0;  /* Keskin köşeler */
        }

        /* Başlık alanını genişlet */
        .card-header .card-title {
            flex: 1;  /* Mevcut boş alanı doldur */
            margin-right: 15px;  /* Simge ile arasında boşluk bırak */
            padding-left: 0;  /* Sol tarafta boşluk bırakma */
        }

        /* Süresi geçmiş görevler için turuncu stil */
        .task-card.status-PENDING[data-overdue="true"] {
            border-left: 5px solid #fd7e14;  /* Bootstrap turuncu */
        }
        .task-card.status-PENDING[data-overdue="true"] .card-header {
            background-color: #fd7e14;
            color: #fff;
        }
        
        .status-PENDING { 
            border-left: 5px solid #ffc107;
        }
        .status-PENDING .card-header {
            background-color: #ffc107;
            color: #000;  /* Sarı arka plan için siyah yazı */
        }
        
        .status-PENDING .status-icon {
            color: #fff !important;  /* beyaz renk */
            font-size: 2rem;
           /* opacity: 0.7; Biraz şeffaf */
        }
        
        .status-COMPLETED { 
            border-left: 5px solid #28a745;
        }
        .status-COMPLETED .card-header {
            background-color: #28a745;
            color: #fff;  /* Beyaz yazı */
        }
        
        .status-CANCELLED { 
            border-left: 5px solid #dc3545;
        }
        .status-CANCELLED .card-header {
            background-color: #dc3545;
            color: #fff;  /* Kırmızı arka plan için beyaz yazı */
        }
        
        .status-icon {
            font-size: 1.8rem;
            margin-left: 10px;
        }
        .status-icon.pending { color: #ffc107; }    /* Sarı */
        .status-icon.completed { color: #28a745; }  /* Yeşil */
        .status-icon.cancelled { color: #dc3545; }  /* Kırmızı */

        .description-text {
            height: 120px;             /* Sabit yükseklik (yaklaşık 8 satır) */
            line-height: 1.5;
            overflow-y: auto;          /* Sadece gerektiğinde kaydırma çubuğu */
            padding: 0.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            background-color: #f8f9fa;
            display: block;           /* Block element olarak göster */
            width: 100%;             /* Tam genişlik */
        }

        .card-header {
            min-height: 50px !important;  /* Başlık yüksekliği */
            border-radius: 0;  /* Keskin köşeler */
        }
        
        .card-title {
            max-height: 60px;            /* Başlık maksimum yüksekliği */
            overflow-y: auto;            /* Sadece gerektiğinde kaydırma çubuğu */
            margin: 0;
            padding-right: 10px;         /* Sağ tarafta simge için boşluk */
            word-wrap: break-word;       /* Uzun kelimeleri alt satıra geçir */
        }
        
        /* Kaydırma çubuğu stilini özelleştir */
        .card-title::-webkit-scrollbar,
        .description-text::-webkit-scrollbar {
            width: 4px;
            display: none;  /* Varsayılan olarak gizle */
        }
        
        /* Sadece hover durumunda ve içerik taşıyorsa scrollbar'ı göster */
        .card-title:hover::-webkit-scrollbar,
        .description-text:hover::-webkit-scrollbar {
            display: block;
        }
        
        .card-title::-webkit-scrollbar-thumb,
        .description-text::-webkit-scrollbar-thumb {
            background-color: #dee2e6;
            border-radius: 4px;
        }

        .task-card.overdue {
            border-left: 5px solid #dc3545;
            background-color: #fff5f5;
        }
        .status-icon.overdue {
            color: #dc3545;
        }
        
        /* Timeline styles */
        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline-item {
            position: relative;
            padding-left: 40px;
            margin-bottom: 20px;
        }

        .timeline-badge {
            position: absolute;
            left: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            color: white;
            line-height: 30px;
        }

        .timeline-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #dee2e6;
        }

        /* Utility classes */
        .flex-wrap {
            flex-wrap: wrap;
        }
        
        .gap-2 {
            gap: 0.5rem;
        }
        
        .btn-group-sm > .btn, .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            line-height: 1.5;
            border-radius: 0.2rem;
        }
        
        textarea.form-control-sm {
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
        }

        /* İptal edilen görevlerin simgesi için özel stil */
        .status-CANCELLED .status-icon {
            color: #ffffff !important;  /* Beyaz renk */
            font-size: 2rem;           /* Biraz daha büyük */
            text-shadow: 0 0 3px rgba(0,0,0,0.3);  /* Okunabilirlik için gölge */
        }

        .status-COMPLETED .status-icon {
            color: #ffffff !important;  /* Beyaz renk */
            font-size: 2rem;  /* Simge boyutunu artır */
            text-shadow: 0 0 3px rgba(0,0,0,0.3);  /* Okunabilirlik için gölge */
        }
        .card {
    --bs-border-radius: 0rem; /* Bootstrap değişkenini sıfırla */
    border-radius: 0rem !important; /* Önceliği yükselt */
}
    </style>
</head>
<body>
    <!-- Navbar başlangıç -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">Görev Takip</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/tasks/create">Yeni Görev</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/tasks/my">Görevlerim</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/friends">
                            <i class="fas fa-users me-1"></i> Arkadaşlarım
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" 
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user me-1"></i>
                            <span sec:authentication="name">Kullanıcı</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li>
                                <form th:action="@{/auth/logout}" method="POST">
                                    <button type="submit" class="dropdown-item">
                                        <i class="fas fa-sign-out-alt me-1"></i> Çıkış Yap
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Navbar bitiş -->

    <div class="container mt-4">
        <!-- Filtre bölümünü güncelle -->
        <div class="mb-4">
            <form method="get" class="row g-3 align-items-center">
                <div class="col-auto">
                    <label class="col-form-label">Durum Filtresi:</label>
                </div>
                <div class="col-auto">
                    <select name="statusFilter" class="form-select" onchange="this.form.submit()">
                        <option value="">
                            <i class="fas fa-filter"></i> Tümü
                        </option>
                        <option value="OVERDUE" th:selected="${currentStatusFilter == 'OVERDUE'}">
                            <i class="fas fa-exclamation-circle text-danger"></i> Süresi Geçmiş
                        </option>
                        <option th:each="status : ${statuses}"
                                th:value="${status.name()}"
                                th:selected="${status.name() == currentStatusFilter}">
                            <i th:class="${'fas ' + 
                                (status.name() == 'COMPLETED' ? 'fa-check-circle text-success' : 
                                 status.name() == 'CANCELLED' ? 'fa-times-circle text-danger' : 
                                 'fa-clock text-warning')}"></i>
                            [[${status.displayValue}]]
                        </option>
                    </select>
                </div>
                
                <div class="col-auto ms-4">
                    <label class="col-form-label">Öncelik Filtresi:</label>
                </div>
                <div class="col-auto">
                    <select name="priorityFilter" class="form-select" onchange="this.form.submit()">
                        <option value="">Tümü</option>
                        <option th:each="priority : ${priorities}"
                                th:value="${priority.name()}"
                                th:text="${priority.displayValue}"
                                th:selected="${priority.name() == currentPriorityFilter}">
                        </option>
                    </select>
                </div>
            </form>
        </div>

        <!-- Oluşturduğum Görevler -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Yaptığım Görevlendirmeler</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div th:each="task : ${createdTasks}" class="col-md-4">
                        <div th:class="'card task-card status-' + ${task.status.name()}"
                             th:data-overdue="${task.status.name() == 'PENDING' && #temporals.createNow().isAfter(task.deadline)}">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0" th:text="${task.title}">Görev Başlığı</h5>
                                <i th:class="${'status-icon fas ' + 
                                             (task.status.name() == 'COMPLETED' ? 'fa-check-circle completed' :
                                              task.status.name() == 'CANCELLED' ? 'fa-times-circle cancelled' :
                                              (task.status.name() == 'PENDING' && #temporals.createNow().isAfter(task.deadline)) ? 'fa-exclamation-circle text-danger' :
                                              'fa-clock pending')}"
                                   th:title="${task.status.displayValue}"></i>
                            </div>
                            <div class="card-body">
                                <p class="card-text description-text" th:text="${task.description}">Açıklama</p>
                                <hr class="my-2">
                                <p class="card-text">
                                    <small class="text-muted">
                                        <i class="fas fa-users me-1"></i> Görevliler:
                                        <span th:each="assignee, iterStat : ${task.assignees}">
                                            <span th:text="${assignee.firstName + ' ' + assignee.lastName + (iterStat.last ? '' : ', ')}"></span>
                                        </span>
                                    </small>
                                </p>
                                <p class="card-text">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        <span th:class="${task.status.name() == 'PENDING' && #temporals.createNow().isAfter(task.deadline) ? 'text-danger fw-bold' : ''}"
                                              th:text="${#temporals.format(task.deadline, 'dd/MM/yyyy HH:mm')}">Tarih</span>
                                    </small>
                                </p>

                                <!-- Açıklama Ekleme Alanı -->
                                <div class="mb-3" th:if="${task.status.name() != 'COMPLETED' && task.status.name() != 'CANCELLED'}">
                                    <textarea class="form-control form-control-sm mb-2" 
                                            th:id="'taskNote-' + ${task.id}" 
                                            rows="2" 
                                            placeholder="Görev ile ilgili açıklama ekleyin..."></textarea>
                                </div>

                                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                                    <button class="btn btn-sm btn-primary" th:onclick="'editTask(' + ${task.id} + ')'">
                                        <i class="fas fa-edit me-1"></i> Düzenle
                                    </button>
                                    
                                    <!-- Açıklama Ekleme Butonu -->
                                    <button class="btn btn-sm btn-info" 
                                            th:if="${task.status.name() != 'COMPLETED' && task.status.name() != 'CANCELLED'}"
                                            th:onclick="'addTaskNote(' + ${task.id} + ')'">
                                        <i class="fas fa-comment me-1"></i> Açıklama Ekle
                                    </button>
                                    
                                    <button class="btn btn-sm btn-danger" 
                                            th:if="${task.status.name() != 'COMPLETED' && task.status.name() != 'CANCELLED'}"
                                            th:onclick="'cancelTask(' + ${task.id} + ')'">
                                        <i class="fas fa-times me-1"></i> İptal Et
                                    </button>
                                </div>

                                <!-- Görev Geçmişi Butonu -->
                                <button class="btn btn-sm btn-info mt-2 w-100" 
                                        th:onclick="'showTaskHistory(' + ${task.id} + ')'">
                                    <i class="fas fa-history me-1"></i> Görev Geçmişi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Görevlendirildiğim Görevler -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Yapacağım Görevler</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div th:each="task : ${assignedTasks}" class="col-md-4">
                        <div class="card task-card mb-3" 
                             th:classappend="${'status-' + task.status.name()}"
                             th:data-overdue="${task.status.name() == 'PENDING' && #temporals.createNow().isAfter(task.deadline)}"
                             th:data-priority="${task.priority}">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0" th:text="${task.title}">Görev Başlığı</h5>
                                <i th:class="${'status-icon fas ' + 
                                             (task.status.name() == 'COMPLETED' ? 'fa-check-circle completed' :
                                              task.status.name() == 'CANCELLED' ? 'fa-times-circle cancelled' :
                                              (task.status.name() == 'PENDING' && #temporals.createNow().isAfter(task.deadline)) ? 'fa-exclamation-circle text-danger' :
                                              'fa-clock pending')}"
                                   th:title="${task.status.displayValue}"></i>
                            </div>
                            <div class="card-body">
                                <p class="card-text description-text" th:text="${task.description}">Açıklama</p>
                                <hr class="my-2">
                                <p class="card-text">
                                    <small class="text-muted">
                                        <i class="fas fa-users me-1"></i> Diğer Görevliler:
                                        <span th:if="${task.assignees.size() > 1}">
                                            <span th:each="assignee, iterStat : ${task.assignees}" 
                                                  th:unless="${assignee.id == currentUser.id}">
                                                <span th:text="${assignee.firstName + ' ' + assignee.lastName + (iterStat.last ? '' : ', ')}"></span>
                                            </span>
                                        </span>
                                        <span th:if="${task.assignees.size() <= 1}">Başka görevli yok</span>
                                    </small>
                                </p>
                                <p class="card-text">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        <span th:class="${task.status.name() == 'PENDING' && #temporals.createNow().isAfter(task.deadline) ? 'text-danger fw-bold' : ''}"
                                              th:text="${#temporals.format(task.deadline, 'dd/MM/yyyy HH:mm')}">Tarih</span>
                                    </small>
                                </p>
                                <div class="mb-3" th:if="${task.status.name() != 'COMPLETED' && task.status.name() != 'CANCELLED'}">
                                    <textarea class="form-control form-control-sm mb-2" 
                                            th:id="'taskNote-' + ${task.id}" 
                                            rows="2" 
                                            placeholder="Görev ile ilgili açıklama ekleyin..."></textarea>
                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-sm btn-info" th:onclick="'addTaskNote(' + ${task.id} + ')'">
                                            <i class="fas fa-comment me-1"></i> Açıklama Ekle
                                        </button>
                                        <button class="btn btn-sm btn-success" th:onclick="'completeTask(' + ${task.id} + ')'">
                                            <i class="fas fa-check me-1"></i> Tamamla
                                        </button>
                                    </div>
                                </div>
                                <!-- Görev Geçmişi Butonu -->
                                <button class="btn btn-sm btn-info mt-2 w-100" 
                                        th:onclick="'showTaskHistory(' + ${task.id} + ')'">
                                    <i class="fas fa-history me-1"></i> Görev Geçmişi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Görev Geçmişi Modal -->
    <div class="modal fade" id="taskHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-history me-1"></i> Görev Geçmişi
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="task-info mb-3">
                        <h6 class="task-title mb-2"></h6>
                        <div class="task-status"></div>
                    </div>
                    
                    <div class="timeline">
                        <!-- Görev geçmişi buraya dinamik olarak yüklenecek -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
    function editTask(taskId) {
        // Görev düzenleme modalını aç
        window.location.href = '/tasks/edit/' + taskId;
    }

    function cancelTask(taskId) {
        if (confirm('Görevi iptal etmek istediğinize emin misiniz?')) {
            fetch('/tasks/' + taskId + '/cancel', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.text())
            .then(result => {
                alert(result);
                location.reload();
            })
            .catch(error => alert('Hata oluştu: ' + error));
        }
    }

    function completeTask(taskId) {
        if (confirm('Görevi tamamlamak istediğinize emin misiniz?')) {
            fetch('/tasks/' + taskId + '/complete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.text())
            .then(result => {
                alert(result);
                location.reload();
            })
            .catch(error => alert('Hata oluştu: ' + error));
        }
    }

    function addTaskNote(taskId) {
        const note = document.getElementById('taskNote-' + taskId).value;
        if (!note.trim()) {
            alert('Lütfen bir açıklama girin');
            return;
        }

        fetch('/tasks/' + taskId + '/note', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ note: note })
        })
        .then(response => response.text())
        .then(result => {
            alert(result);
            location.reload();
        })
        .catch(error => alert('Hata oluştu: ' + error));
    }

    function showTaskHistory(taskId) {
        const modal = new bootstrap.Modal(document.getElementById('taskHistoryModal'));
        const timeline = document.querySelector('#taskHistoryModal .timeline');
        
        fetch(`/tasks/${taskId}/history`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // Görev başlığını ve durumunu güncelle
                document.querySelector('#taskHistoryModal .task-title').textContent = data.task.title;
                const statusBadge = getStatusBadge(data.task.status);
                document.querySelector('#taskHistoryModal .task-status').innerHTML = statusBadge;
                
                // Timeline içeriğini oluştur
                let timelineHtml = '';
                
                // Tüm olayları tarih sırasına göre birleştir
                let allEvents = [];
                
                // Notları ekle
                if (data.notes && data.notes.length > 0) {
                    data.notes.forEach(note => {
                        allEvents.push({
                            type: 'NOTE',
                            date: new Date(note.createdAt),
                            data: note
                        });
                    });
                }
                
                // Durum değişikliklerini ekle
                if (data.history && data.history.length > 0) {
                    data.history.forEach(event => {
                        allEvents.push({
                            type: event.type,
                            date: new Date(event.date),
                            data: event
                        });
                    });
                }
                
                // Olayları tarihe göre sırala (en yeni en üstte)
                allEvents.sort((a, b) => b.date - a.date);
                
                if (allEvents.length > 0) {
                    allEvents.forEach(event => {
                        if (event.type === 'NOTE') {
                            timelineHtml += `
                                <div class="timeline-item">
                                    <div class="timeline-badge bg-info">
                                        <i class="fas fa-comment"></i>
                                    </div>
                                    <div class="timeline-content">
                                        <div class="d-flex justify-content-between">
                                            <strong>${event.data.user.firstName} ${event.data.user.lastName}</strong>
                                            <small class="text-muted">${formatDate(event.data.createdAt)}</small>
                                        </div>
                                        <p class="mb-0">${event.data.note}</p>
                                    </div>
                                </div>
                            `;
                        } else if (event.type === 'COMPLETED') {
                            timelineHtml += `
                                <div class="timeline-item">
                                    <div class="timeline-badge bg-success">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="timeline-content">
                                        <div class="d-flex justify-content-between">
                                            <strong>${event.data.user.firstName} ${event.data.user.lastName} görevi tamamladı</strong>
                                            <small class="text-muted">${formatDate(event.data.date)}</small>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }
                    });
                } else {
                    timelineHtml = '<div class="text-center text-muted">Henüz görev geçmişi bulunmuyor.</div>';
                }
                
                timeline.innerHTML = timelineHtml;
                modal.show();
            })
            .catch(error => {
                alert('Görev geçmişi yüklenirken hata oluştu: ' + error.message);
                console.error(error);
            });
    }

    function getStatusBadge(status) {
        const statusClasses = {
            'PENDING': 'bg-warning',
            'COMPLETED': 'bg-success',
            'CANCELLED': 'bg-danger'
        };
        
        return `<span class="badge ${statusClasses[status]}">${getStatusText(status)}</span>`;
    }

    function getStatusText(status) {
        const statusTexts = {
            'PENDING': 'Beklemede',
            'COMPLETED': 'Tamamlandı',
            'CANCELLED': 'İptal Edildi'
        };
        return statusTexts[status];
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleString('tr-TR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    $(document).ready(function() {
        $('select[name="statusFilter"]').select2({
            theme: 'bootstrap-5',
            minimumResultsForSearch: Infinity,
            templateResult: function(state) {
                if (!state.id) {
                    return $('<span><i class="fas fa-filter"></i> Tümü</span>');
                }
                
                let icon = '';
                if (state.id === 'OVERDUE') {
                    icon = '<i class="fas fa-exclamation-circle text-danger"></i>';
                } else if (state.id === 'COMPLETED') {
                    icon = '<i class="fas fa-check-circle text-success"></i>';
                } else if (state.id === 'CANCELLED') {
                    icon = '<i class="fas fa-times-circle text-danger"></i>';
                } else if (state.id === 'PENDING') {
                    icon = '<i class="fas fa-clock text-warning"></i>';
                }
                
                return $('<span>' + icon + ' ' + state.text + '</span>');
            },
            templateSelection: function(state) {
                if (!state.id) {
                    return $('<span><i class="fas fa-filter"></i> Tümü</span>');
                }
                
                let icon = '';
                if (state.id === 'OVERDUE') {
                    icon = '<i class="fas fa-exclamation-circle text-danger"></i>';
                } else if (state.id === 'COMPLETED') {
                    icon = '<i class="fas fa-check-circle text-success"></i>';
                } else if (state.id === 'CANCELLED') {
                    icon = '<i class="fas fa-times-circle text-danger"></i>';
                } else if (state.id === 'PENDING') {
                    icon = '<i class="fas fa-clock text-warning"></i>';
                }
                
                return $('<span>' + icon + ' ' + state.text + '</span>');
            }
        });
    });
    </script>
</body>
</html> 